@(publications: List[models.PublicationWithAuthor], status: Option[String])(implicit request: RequestHeader, flash: Flash)

@admin.adminLayout("Publicaciones") {
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.25rem; flex-wrap: wrap; gap: 0.75rem;">
        <h2 style="font-size: 1.125rem; font-weight: 700; color: #1a202c;">Publicaciones</h2>
        <form method="GET" action="@routes.AdminController.allPublications()">
            <select name="status" onchange="this.form.submit()" style="font-size: 0.8125rem;">
                <option value="" @if(status.isEmpty){ selected }>Todas</option>
                <option value="pending" @if(status.contains("pending")){ selected }>Pendientes</option>
                <option value="approved" @if(status.contains("approved")){ selected }>Aprobadas</option>
                <option value="rejected" @if(status.contains("rejected")){ selected }>Rechazadas</option>
                <option value="draft" @if(status.contains("draft")){ selected }>Borradores</option>
            </select>
        </form>
    </div>

    @if(publications.isEmpty) {
        <div class="card" style="text-align: center; padding: 3rem;">
            <p class="text-muted text-sm">No hay publicaciones para este filtro</p>
        </div>
    } else {
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem; overflow: hidden;">
            @for(pubWithAuthor <- publications) {
                @defining(pubWithAuthor.publication) { pub =>
                    <div class="card">
                        <div style="font-size: 1rem; font-weight: 700; color: #1a202c; margin-bottom: 0.5rem; word-break: break-word; overflow-wrap: break-word;">@pub.title</div>
                        <div style="color: #64748b; font-size: 0.8125rem; display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap; margin-bottom: 0.75rem;">
                            <span>@pubWithAuthor.authorFullName (@("@")@pubWithAuthor.authorUsername)</span>
                            <span>@pub.category</span>
                            <span>@pub.updatedAt.toString.substring(0, 10)</span>
                            <span class="badge @{"badge-" + pub.status}">@pub.status</span>
                        </div>
                        @if(pub.excerpt.isDefined) {
                            <p style="color: #475569; font-size: 0.8125rem; margin-bottom: 0.75rem; overflow-wrap: break-word; word-break: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical;">@pub.excerpt.get</p>
                        } else {
                            <p style="color: #94a3b8; font-size: 0.8125rem; margin-bottom: 0.75rem; overflow-wrap: break-word; word-break: break-word; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical;">@pub.content.take(200)</p>
                        }
                        <div style="display: flex; gap: 0.375rem; padding-top: 0.75rem; border-top: 1px solid #f1f5f9; flex-wrap: wrap;">
                            <a class="btn btn-secondary btn-sm" href="@routes.AdminController.reviewPublicationDetail(pub.id.get)">Ver</a>
                            <form method="POST" action="@routes.AdminController.approvePublication(pub.id.get)" style="display:inline">
                                @helper.CSRF.formField
                                <button class="btn btn-success btn-sm" type="submit">Aprobar</button>
                            </form>
                            <button class="btn btn-warning btn-sm" onclick="location.href='@routes.AdminController.reviewPublicationDetail(pub.id.get)#reject'">Rechazar</button>
                            <form method="POST" action="@routes.AdminController.deletePublication(pub.id.get)" style="display:inline" onsubmit="return confirm('Eliminar publicaciÃ³n?')">
                                @helper.CSRF.formField
                                <button class="btn btn-danger btn-sm" type="submit">Eliminar</button>
                            </form>
                        </div>
                    </div>
                }
            }
        </div>
    }
}

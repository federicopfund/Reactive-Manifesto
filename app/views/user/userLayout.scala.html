@(title: String, username: String)(content: Html)(implicit request: RequestHeader, flash: Flash)

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@title - Reactive Manifesto</title>
    <meta name="description" content="Reactive Manifesto â€” Panel de usuario. Gestiona tus publicaciones y perfil.">
    <link rel="icon" type="image/svg+xml" href="@routes.Assets.versioned("favicon.svg")">
    <meta property="og:title" content="@title - Reactive Manifesto">
    <meta name="twitter:card" content="summary">
    <link rel="stylesheet" href="@routes.Assets.versioned("stylesheets/admin.css")">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f3f4f6;
            color: #4b5563;
            min-height: 100vh;
        }

        /* â”€â”€ NAVBAR â”€â”€ */
        .u-navbar {
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            height: 52px;
            position: sticky;
            top: 0;
            z-index: 900;
        }
        .u-navbar-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            height: 100%;
            gap: 1.25rem;
        }

        /* Brand */
        .u-brand {
            font-size: 0.875rem;
            font-weight: 700;
            color: #1a202c;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            white-space: nowrap;
            letter-spacing: -0.01em;
        }
        .u-brand-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background: #9ca3af;
            flex-shrink: 0;
        }

        /* Separator */
        .u-sep {
            width: 1px;
            height: 20px;
            background: #e2e8f0;
            flex-shrink: 0;
        }

        /* Nav links */
        .u-nav {
            display: flex;
            align-items: center;
            height: 100%;
            gap: 0;
        }
        .u-nav a {
            display: flex;
            align-items: center;
            height: 100%;
            padding: 0 0.75rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: #64748b;
            text-decoration: none;
            border-bottom: 2px solid transparent;
            transition: color 0.15s, border-color 0.15s;
            white-space: nowrap;
        }
        .u-nav a:hover,
        .u-nav a.active {
            color: #1a202c;
            border-bottom-color: #475569;
        }

        /* Nav dropdown */
        .u-nav-dropdown {
            position: relative;
            display: flex;
            align-items: center;
            height: 100%;
        }
        .u-nav-dropdown-toggle {
            display: flex;
            align-items: center;
            height: 100%;
            padding: 0 0.75rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: #64748b;
            text-decoration: none;
            border: none;
            border-bottom: 2px solid transparent;
            background: transparent;
            cursor: pointer;
            gap: 0.25rem;
            transition: color 0.15s, border-color 0.15s;
            white-space: nowrap;
        }
        .u-nav-dropdown-toggle:hover,
        .u-nav-dropdown.open .u-nav-dropdown-toggle {
            color: #1a202c;
            border-bottom-color: #475569;
        }
        .u-nav-dropdown-toggle svg {
            transition: transform 0.2s ease;
        }
        .u-nav-dropdown.open .u-nav-dropdown-toggle svg {
            transform: rotate(180deg);
        }
        .u-nav-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 200px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1), 0 2px 6px rgba(0,0,0,0.04);
            padding: 0.375rem 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(6px);
            transition: opacity 0.18s ease, transform 0.18s ease, visibility 0.18s;
            z-index: 100;
        }
        .u-nav-dropdown.open .u-nav-dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .u-nav-dropdown-menu a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.875rem;
            font-size: 0.8125rem;
            font-weight: 500;
            color: #475569;
            text-decoration: none;
            border-bottom: none;
            transition: background 0.12s, color 0.12s;
            white-space: nowrap;
        }
        .u-nav-dropdown-menu a:hover {
            background: #f1f5f9;
            color: #1a202c;
        }
        .u-nav-dropdown-menu .u-dd-icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            flex-shrink: 0;
            opacity: 0.6;
        }
        .u-nav-dropdown-menu .u-dd-sep {
            height: 1px;
            background: #e2e8f0;
            margin: 0.25rem 0;
        }

        /* Right cluster */
        .u-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Username chip */
        .u-user-chip {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.625rem;
            background: #f8fafc;
            border: 1px solid #e8ecf0;
            border-radius: 6px;
            font-size: 0.75rem;
            color: #475569;
            text-decoration: none;
            transition: all 0.15s;
        }
        .u-user-chip:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
            color: #1a202c;
        }
        .u-avatar-sm {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5625rem;
            font-weight: 700;
            color: #64748b;
            flex-shrink: 0;
        }

        /* Notification bell */
        .u-notif-bell {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            color: #64748b;
            text-decoration: none;
            transition: all 0.15s;
        }
        .u-notif-bell:hover {
            background: #f1f5f9;
            color: #1a202c;
        }
        .u-notif-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            min-width: 15px;
            height: 15px;
            border-radius: 50px;
            background: #c46b6b;
            color: white;
            font-size: 0.5625rem;
            font-weight: 700;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 0 3px;
            line-height: 1;
            border: 1.5px solid white;
        }
        .u-notif-badge.has-notifs {
            display: flex;
        }

        /* Cmd trigger */
        .u-cmd-trigger {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.3rem 0.625rem;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            color: #94a3b8;
            font-size: 0.6875rem;
            cursor: pointer;
            transition: all 0.15s;
            white-space: nowrap;
        }
        .u-cmd-trigger:hover {
            background: #e8ecf0;
            color: #64748b;
            border-color: #cbd5e1;
        }
        .u-cmd-trigger kbd {
            font-family: inherit;
            font-size: 0.625rem;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 3px;
            padding: 0.1rem 0.25rem;
            color: #94a3b8;
            line-height: 1;
        }

        /* Logout */
        .u-logout {
            font-size: 0.6875rem;
            font-weight: 500;
            color: #9ca3af;
            text-decoration: none;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
            transition: all 0.15s;
        }
        .u-logout:hover {
            background: #fef2f2;
            color: #dc2626;
        }

        /* â”€â”€ COMMAND PALETTE â”€â”€ */
        .u-cmd-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.4);
            z-index: 9999;
            backdrop-filter: blur(3px);
            animation: uCmdFade 0.12s ease-out;
        }
        .u-cmd-overlay.open {
            display: flex;
            justify-content: center;
            padding-top: 14vh;
        }
        .u-cmd-box {
            background: #ffffff;
            border-radius: 12px;
            width: 480px;
            max-width: 92vw;
            max-height: 70vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 40px rgba(0,0,0,0.16), 0 0 0 1px rgba(0,0,0,0.04);
            overflow: hidden;
            animation: uCmdSlide 0.12s ease-out;
        }
        .u-cmd-search-row {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #e8ecf0;
            gap: 0.625rem;
        }
        .u-cmd-search-row svg { color: #94a3b8; flex-shrink: 0; }
        .u-cmd-input {
            flex: 1;
            border: none;
            outline: none;
            font-size: 0.875rem;
            color: #1a202c;
            background: transparent;
        }
        .u-cmd-input::placeholder { color: #cbd5e1; }
        .u-cmd-esc {
            font-size: 0.625rem;
            color: #94a3b8;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 3px;
            padding: 0.125rem 0.325rem;
        }
        .u-cmd-group {
            font-size: 0.625rem;
            font-weight: 700;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            padding: 0.625rem 1rem 0.25rem;
        }
        .u-cmd-list {
            flex: 1;
            min-height: 0;
            overflow-y: auto;
            padding: 0.25rem 0.5rem 0.5rem;
        }
        .u-cmd-item {
            display: flex;
            align-items: center;
            gap: 0.625rem;
            padding: 0.5rem 0.625rem;
            border-radius: 7px;
            text-decoration: none;
            color: #374151;
            font-size: 0.8125rem;
            transition: background 0.1s;
            cursor: pointer;
        }
        .u-cmd-item:hover,
        .u-cmd-item.u-active {
            background: #f1f5f9;
        }
        .u-cmd-icon {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8fafc;
            border: 1px solid #e8ecf0;
            border-radius: 6px;
            flex-shrink: 0;
        }
        .u-cmd-icon svg {
            width: 14px;
            height: 14px;
            stroke: #64748b;
            fill: none;
            stroke-width: 2;
        }
        .u-cmd-text { flex: 1; }
        .u-cmd-text span {
            display: block;
            font-weight: 500;
            font-size: 0.8125rem;
            line-height: 1.3;
        }
        .u-cmd-text small {
            color: #94a3b8;
            font-size: 0.6875rem;
        }

        /* â”€â”€ MAIN CONTENT â”€â”€ */
        .u-main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.75rem 1.5rem;
        }

        /* Toast Container */
        .toast-container {
            position: fixed;
            top: 76px;
            right: 1.25rem;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            pointer-events: none;
        }
        .toast {
            pointer-events: all;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 10px;
            font-size: 0.8125rem;
            font-weight: 500;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.06);
            backdrop-filter: blur(12px);
            transform: translateX(120%);
            opacity: 0;
            animation: toastIn 0.35s cubic-bezier(0.22,1,0.36,1) forwards;
            max-width: 380px;
            line-height: 1.4;
        }
        .toast.toast-out {
            animation: toastOut 0.3s cubic-bezier(0.22,1,0.36,1) forwards;
        }
        .toast-success {
            background: rgba(240, 253, 244, 0.95);
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .toast-error {
            background: rgba(254, 242, 242, 0.95);
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .toast-info {
            background: rgba(239, 246, 255, 0.95);
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }
        .toast-icon {
            flex-shrink: 0;
            font-size: 1rem;
        }
        .toast-close {
            flex-shrink: 0;
            background: none;
            border: none;
            color: inherit;
            opacity: 0.5;
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            margin-left: 0.5rem;
            line-height: 1;
        }
        .toast-close:hover { opacity: 1; }
        @@keyframes toastIn {
            from { transform: translateX(120%); opacity: 0; }
            to   { transform: translateX(0); opacity: 1; }
        }
        @@keyframes toastOut {
            from { transform: translateX(0); opacity: 1; }
            to   { transform: translateX(120%); opacity: 0; }
        }

        /* â”€â”€ SHARED COMPONENTS â”€â”€ */
        .u-card {
            background: #ffffff;
            border: 1px solid #e8ecf0;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
        }
        .u-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.15s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }
        .u-btn-primary { background: #4b5563; color: #fff; }
        .u-btn-primary:hover { background: #374151; }
        .u-btn-success { background: #6b7280; color: #fff; }
        .u-btn-success:hover { background: #4b5563; }
        .u-btn-secondary { background: #f9fafb; color: #4b5563; border: 1px solid #e5e7eb; }
        .u-btn-secondary:hover { background: #f3f4f6; border-color: #d1d5db; }
        .u-btn-danger { background: #ef4444; color: #fff; }
        .u-btn-danger:hover { background: #dc2626; }
        .u-btn-sm { padding: 0.325rem 0.625rem; font-size: 0.75rem; }

        .u-badge {
            display: inline-block;
            padding: 0.175rem 0.5rem;
            border-radius: 50px;
            font-size: 0.6875rem;
            font-weight: 600;
        }
        .u-badge-pending  { background: #fffbeb; color: #92400e; }
        .u-badge-approved { background: #ecfdf5; color: #065f46; }
        .u-badge-rejected { background: #fef2f2; color: #991b1b; }
        .u-badge-draft    { background: #f3f4f6; color: #6b7280; }

        table { width: 100%; border-collapse: collapse; }
        th {
            text-align: left;
            padding: 0.625rem 0.75rem;
            font-size: 0.6875rem;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            border-bottom: 1px solid #e8ecf0;
        }
        td {
            padding: 0.625rem 0.75rem;
            font-size: 0.8125rem;
            border-bottom: 1px solid #f1f5f9;
            color: #374151;
        }
        tr:hover td { background: #fafbfc; }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="u-navbar">
        <div class="u-navbar-inner">
            <a href="@routes.HomeController.index()" class="u-brand">
                <span class="u-brand-dot"></span>
                Reactive Manifesto
            </a>

            <div class="u-sep"></div>

            <div class="u-nav">
                <a href="@routes.AuthController.userDashboard()">Inicio</a>
                <div class="u-nav-dropdown" id="pubDropdown">
                    <button type="button" class="u-nav-dropdown-toggle" onclick="togglePubDropdown(event)">
                        Publicaciones
                        <svg width="10" height="10" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/></svg>
                    </button>
                    <div class="u-nav-dropdown-menu">
                        <a href="@routes.UserPublicationController.dashboard()">
                            <span class="u-dd-icon">âŒ‚</span> Dashboard
                        </a>
                        <a href="@routes.UserPublicationController.newPublicationForm()">
                            <span class="u-dd-icon">+</span> Nueva publicaciÃ³n
                        </a>
                        <div class="u-dd-sep"></div>
                        <a href="@routes.HomeController.publicaciones()">
                            <span class="u-dd-icon">â—‹</span> Explorar comunidad
                        </a>
                    </div>
                </div>
                <a href="@routes.UserPublicationController.bookmarks()">ðŸ”– Favoritos</a>
            </div>

            <div class="u-right">
                <a href="@routes.UserPublicationController.inbox("received")" class="u-notif-bell" title="Mensajes" id="msgBell" style="margin-right: 0.25rem;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                    <span class="u-notif-badge" id="msgBadge"></span>
                </a>

                <a href="@routes.UserPublicationController.notifications()" class="u-notif-bell" title="Notificaciones" id="notifBell">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    <span class="u-notif-badge" id="notifBadge"></span>
                </a>

                <button type="button" class="u-cmd-trigger" onclick="openUserCmd()">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    Acciones
                    <kbd>Ctrl K</kbd>
                </button>

                <a href="@routes.UserPublicationController.publicProfile(username)" class="u-user-chip">
                    <span class="u-avatar-sm">@username.substring(0,1).toUpperCase</span>
                    <span>@username</span>
                </a>

                <a href="@routes.AuthController.logout()" class="u-logout">Salir</a>
            </div>
        </div>
    </nav>

    <!-- COMMAND PALETTE -->
    <div id="uCmdOverlay" class="u-cmd-overlay" onclick="if(event.target===this)closeUserCmd()">
        <div class="u-cmd-box">
            <div class="u-cmd-search-row">
                <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                <input id="uCmdInput" class="u-cmd-input" type="text" placeholder="Buscar acci@("Ã³")n..." autocomplete="off">
                <span class="u-cmd-esc">ESC</span>
            </div>
            <div class="u-cmd-list" id="uCmdList">
                <div class="u-cmd-group">NavegaciÃ³n</div>
                <a class="u-cmd-item" href="@routes.AuthController.userDashboard()" data-s="inicio dashboard home panel">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg></div>
                    <div class="u-cmd-text"><span>Inicio</span><small>Dashboard personal</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.UserPublicationController.dashboard()" data-s="publicaciones mis articulos gestionar lista">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div>
                    <div class="u-cmd-text"><span>Mis Publicaciones</span><small>Gestionar artÃ­culos propios</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.HomeController.publicaciones()" data-s="explorar articulos leer todos publicaciones">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></div>
                    <div class="u-cmd-text"><span>Explorar Publicaciones</span><small>Leer artÃ­culos publicados</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.HomeController.portafolio()" data-s="portafolio proyectos demos repositorios">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg></div>
                    <div class="u-cmd-text"><span>Portafolio</span><small>Proyectos y demos interactivos</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.UserPublicationController.bookmarks()" data-s="favoritos guardados bookmarks marcados leer despues">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg></div>
                    <div class="u-cmd-text"><span>Mis Favoritos</span><small>Publicaciones guardadas</small></div>
                </a>

                <div class="u-cmd-group">Acciones</div>
                <a class="u-cmd-item" href="@routes.UserPublicationController.newPublicationForm()" data-s="nueva crear publicacion escribir articulo nuevo">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></div>
                    <div class="u-cmd-text"><span>Nueva PublicaciÃ³n</span><small>Crear un nuevo artÃ­culo</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.UserPublicationController.notifications()" data-s="notificaciones feedback avisos bell campana">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg></div>
                    <div class="u-cmd-text"><span>Notificaciones</span><small>Ver feedback y actualizaciones</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.UserPublicationController.inbox("received")" data-s="mensajes privados inbox bandeja correo mensaje">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
                    <div class="u-cmd-text"><span>Mensajes</span><small>Bandeja de mensajes privados</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.HomeController.index()#contact" data-s="contacto mensaje enviar formulario">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
                    <div class="u-cmd-text"><span>Contacto</span><small>Enviar un mensaje</small></div>
                </a>

                <div class="u-cmd-group">Cuenta</div>
                <a class="u-cmd-item" href="@routes.UserPublicationController.publicProfile(username)" data-s="perfil cuenta usuario configuracion datos">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
                    <div class="u-cmd-text"><span>Mi Perfil</span><small>Ver perfil pÃºblico</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.UserPublicationController.editProfileForm()" data-s="editar perfil bio avatar website ubicacion">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></div>
                    <div class="u-cmd-text"><span>Editar Perfil</span><small>Actualizar bio, avatar, sitio web</small></div>
                </a>
                <a class="u-cmd-item" href="@routes.AuthController.logout()" data-s="salir cerrar sesion logout">
                    <div class="u-cmd-icon"><svg viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></div>
                    <div class="u-cmd-text"><span>Cerrar SesiÃ³n</span><small>Salir de tu cuenta</small></div>
                </a>
            </div>
        </div>
    </div>

    <!-- TOAST CONTAINER -->
    <div class="toast-container" id="toastContainer">
        @flash.get("success").map { msg =>
            <div class="toast toast-success" data-auto-dismiss="4000">
                <span class="toast-icon">âœ“</span>
                <span>@msg</span>
                <button class="toast-close" onclick="dismissToast(this)">&times;</button>
            </div>
        }
        @flash.get("error").map { msg =>
            <div class="toast toast-error" data-auto-dismiss="6000">
                <span class="toast-icon">âš </span>
                <span>@msg</span>
                <button class="toast-close" onclick="dismissToast(this)">&times;</button>
            </div>
        }
        @flash.get("info").map { msg =>
            <div class="toast toast-info" data-auto-dismiss="4000">
                <span class="toast-icon">â„¹</span>
                <span>@msg</span>
                <button class="toast-close" onclick="dismissToast(this)">&times;</button>
            </div>
        }
    </div>

    <!-- BACK TO TOP -->
    <button class="back-to-top" id="backToTopUser" aria-label="Volver arriba" onclick="window.scrollTo({top:0,behavior:'smooth'})">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"/></svg>
    </button>

    <!-- CONTENT -->
    <div class="u-main">
        @content
    </div>

    <script>
    // â”€â”€ Pub dropdown toggle â”€â”€
    window.togglePubDropdown = function(e) {
        e.stopPropagation();
        var dd = document.getElementById('pubDropdown');
        dd.classList.toggle('open');
    };
    document.addEventListener('click', function(e) {
        var dd = document.getElementById('pubDropdown');
        if (dd && !dd.contains(e.target)) dd.classList.remove('open');
    });
    </script>

    <script>
    (function(){
        var ov = document.getElementById('uCmdOverlay');
        var inp = document.getElementById('uCmdInput');
        var items = document.querySelectorAll('.u-cmd-item');
        var groups = document.querySelectorAll('.u-cmd-group');
        var idx = -1;

        window.openUserCmd = function(){
            ov.classList.add('open');
            inp.value = '';
            filter('');
            inp.focus();
            idx = -1;
        };
        window.closeUserCmd = function(){ ov.classList.remove('open'); };

        document.addEventListener('keydown', function(e){
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                ov.classList.contains('open') ? closeUserCmd() : openUserCmd();
            }
            if (e.key === 'Escape' && ov.classList.contains('open')) closeUserCmd();
        });

        inp.addEventListener('input', function(){ filter(this.value.toLowerCase()); idx = -1; hilite(); });

        inp.addEventListener('keydown', function(e){
            var vis = visible();
            if (e.key === 'ArrowDown') { e.preventDefault(); idx = Math.min(idx+1, vis.length-1); hilite(); }
            else if (e.key === 'ArrowUp') { e.preventDefault(); idx = Math.max(idx-1, 0); hilite(); }
            else if (e.key === 'Enter' && idx >= 0) { e.preventDefault(); vis[idx].click(); }
        });

        function filter(q){
            items.forEach(function(el){
                var t = (el.textContent + ' ' + (el.dataset.s||'')).toLowerCase();
                el.style.display = (!q || t.indexOf(q) !== -1) ? 'flex' : 'none';
            });
            groups.forEach(function(g){
                var n = g.nextElementSibling, has = false;
                while(n && !n.classList.contains('u-cmd-group')){
                    if(n.classList.contains('u-cmd-item') && n.style.display !== 'none') has = true;
                    n = n.nextElementSibling;
                }
                g.style.display = has ? 'block' : 'none';
            });
        }
        function visible(){ var a=[]; items.forEach(function(el){ if(el.style.display!=='none') a.push(el); }); return a; }
        function hilite(){
            var vis = visible();
            items.forEach(function(el){ el.classList.remove('u-active'); });
            if(idx >= 0 && idx < vis.length){ vis[idx].classList.add('u-active'); vis[idx].scrollIntoView({block:'nearest'}); }
        }
    })();
    </script>

    <script>
    // Notification badge polling
    (function(){
        var badge = document.getElementById('notifBadge');
        function checkNotifs() {
            fetch('/api/user/notifications/unread')
                .then(function(r){ return r.json(); })
                .then(function(d){
                    if (d.count > 0) {
                        badge.textContent = d.count > 9 ? '9+' : d.count;
                        badge.classList.add('has-notifs');
                    } else {
                        badge.classList.remove('has-notifs');
                    }
                })
                .catch(function(){});
        }
        checkNotifs();
        setInterval(checkNotifs, 30000);
    })();
    </script>

    <script>
    // Message badge polling (reactive messaging)
    (function(){
        var badge = document.getElementById('msgBadge');
        function checkMsgs() {
            fetch('/api/user/messages/unread')
                .then(function(r){ return r.json(); })
                .then(function(d){
                    if (d.count > 0) {
                        badge.textContent = d.count > 9 ? '9+' : d.count;
                        badge.classList.add('has-notifs');
                    } else {
                        badge.classList.remove('has-notifs');
                    }
                })
                .catch(function(){});
        }
        checkMsgs();
        setInterval(checkMsgs, 30000);
    })();
    </script>

    <script>
    // â”€â”€ Toast auto-dismiss â”€â”€
    window.dismissToast = function(btn) {
        var t = btn.closest('.toast');
        if (t) { t.classList.add('toast-out'); setTimeout(function(){ t.remove(); }, 300); }
    };
    document.querySelectorAll('.toast[data-auto-dismiss]').forEach(function(t) {
        var ms = parseInt(t.getAttribute('data-auto-dismiss')) || 4000;
        setTimeout(function() {
            t.classList.add('toast-out');
            setTimeout(function(){ t.remove(); }, 300);
        }, ms);
    });

    // â”€â”€ Back to top â”€â”€
    (function(){
        var btt = document.getElementById('backToTopUser');
        if (btt) {
            window.addEventListener('scroll', function() {
                btt.classList.toggle('visible', window.scrollY > 400);
            }, { passive: true });
        }
    })();
    </script>
</body>
</html>

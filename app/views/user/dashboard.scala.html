@(username: String, publications: List[models.Publication], stats: Map[String, Int], feedbackCounts: Map[Long, Int], badges: List[models.UserBadge] = List.empty)(implicit request: RequestHeader, flash: Flash)

@user.userLayout("Mis Publicaciones", username) {
    <!-- Welcome + Actions -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 0.75rem;">
        <div>
            <h2 style="font-size: 1.125rem; font-weight: 700; color: #1a202c; margin-bottom: 0.25rem;">Mis Publicaciones</h2>
            <p style="font-size: 0.8125rem; color: #94a3b8;">Gestiona tus art√≠culos y crea nuevo contenido</p>
        </div>
        <a href="@routes.UserPublicationController.newPublicationForm()" class="u-btn u-btn-primary">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Nueva Publicaci√≥n
        </a>
    </div>

    <!-- Stats -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 0.75rem; margin-bottom: 1.5rem;">
        <div class="u-card" style="padding: 1rem; margin-bottom: 0; border-left: 3px solid #94a3b8;">
            <div style="font-size: 0.6875rem; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 0.25rem;">Borradores</div>
            <div style="font-size: 1.5rem; font-weight: 700; color: #1a202c;">@stats.getOrElse("draft", 0)</div>
        </div>
        <div class="u-card" style="padding: 1rem; margin-bottom: 0; border-left: 3px solid #d4a853;">
            <div style="font-size: 0.6875rem; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 0.25rem;">Pendientes</div>
            <div style="font-size: 1.5rem; font-weight: 700; color: #1a202c;">@stats.getOrElse("pending", 0)</div>
        </div>
        <div class="u-card" style="padding: 1rem; margin-bottom: 0; border-left: 3px solid #6b8f71;">
            <div style="font-size: 0.6875rem; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 0.25rem;">Aprobadas</div>
            <div style="font-size: 1.5rem; font-weight: 700; color: #1a202c;">@stats.getOrElse("approved", 0)</div>
        </div>
        <div class="u-card" style="padding: 1rem; margin-bottom: 0; border-left: 3px solid #8b4c4c;">
            <div style="font-size: 0.6875rem; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 0.25rem;">Rechazadas</div>
            <div style="font-size: 1.5rem; font-weight: 700; color: #1a202c;">@stats.getOrElse("rejected", 0)</div>
        </div>
    </div>

    <!-- Badges Section -->
    @if(badges.nonEmpty) {
        <div class="u-card" style="margin-bottom: 1.5rem; padding: 1.25rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                <h3 style="font-size: 0.9375rem; font-weight: 700; color: #1a202c; margin: 0;">üèÜ Mis Insignias</h3>
                <a href="@routes.UserPublicationController.publicProfile(username)" style="font-size: 0.75rem; color: #6b8caa; text-decoration: none;">Ver perfil ‚Üí</a>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                @for(badge <- badges) {
                    @defining(models.BadgeDefinition.get(badge.badgeKey)) { defnOpt =>
                        @defnOpt.map { defn =>
                            <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.3rem 0.625rem; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.75rem; color: #475569;" title="@defn.description">
                                @defn.icon @defn.name
                            </span>
                        }
                    }
                }
            </div>
        </div>
    }

    <!-- Publications Table -->
    <div class="u-card" style="padding: 0; overflow: hidden;">
        @if(publications.isEmpty) {
            <div style="text-align: center; padding: 3rem 1.5rem;">
                <p style="font-size: 1.5rem; margin-bottom: 0.75rem;">&#9998;</p>
                <h3 style="font-size: 1rem; font-weight: 600; color: #1a202c; margin-bottom: 0.375rem;">Sin publicaciones</h3>
                <p style="color: #94a3b8; font-size: 0.8125rem; margin-bottom: 1.25rem;">Crea tu primer art√≠culo y comparte tu conocimiento</p>
                <a href="@routes.UserPublicationController.newPublicationForm()" class="u-btn u-btn-primary">Nueva Publicaci√≥n</a>
            </div>
        } else {
            <table>
                <thead>
                    <tr>
                        <th>T√≠tulo</th>
                        <th>Categor√≠a</th>
                        <th>Estado</th>
                        <th>Vistas</th>
                        <th>Fecha</th>
                        <th>Acciones</th>
                        <th style="text-align: center;">Eliminar</th>
                    </tr>
                </thead>
                <tbody>
                    @for(pub <- publications) {
                        <tr>
                            <td style="font-weight: 600; color: #1a202c;">@pub.title</td>
                            <td>@pub.category</td>
                            <td>
                                <span class="u-badge u-badge-@pub.status">
                                    @pub.status match {
                                        case "draft" => { Borrador }
                                        case "pending" => { Pendiente }
                                        case "approved" => { Aprobada }
                                        case "rejected" => { Rechazada }
                                        case _ => { @pub.status }
                                    }
                                </span>
                            </td>
                            <td>@pub.viewCount</td>
                            <td style="white-space: nowrap;">@pub.createdAt.toString.substring(0, 10)</td>
                            <td>
                                <div style="display: flex; gap: 0.375rem; flex-wrap: wrap; align-items: center;">
                                    <a href="@routes.UserPublicationController.viewPublication(pub.id.get)" class="u-btn u-btn-secondary u-btn-sm">Ver</a>
                                    @if(feedbackCounts.getOrElse(pub.id.get, 0) > 0) {
                                        <a href="@routes.UserPublicationController.viewPublication(pub.id.get)" class="u-btn u-btn-sm" style="background:#eef4fa; color:#5a7892; border:1px solid #c8d9e6; text-decoration:none; display:inline-flex; align-items:center; gap:0.25rem;" title="Feedback del equipo editorial">
                                            üí¨ @feedbackCounts(pub.id.get)
                                        </a>
                                    }
                                    @if(pub.status == "draft") {
                                        <a href="@routes.UserPublicationController.editPublicationForm(pub.id.get)" class="u-btn u-btn-secondary u-btn-sm">Editar</a>
                                        <form method="POST" action="@routes.UserPublicationController.submitForReview(pub.id.get)" style="display:inline;">
                                            @helper.CSRF.formField
                                            <button type="submit" class="u-btn u-btn-success u-btn-sm">Enviar</button>
                                        </form>
                                    }
                                    @if(pub.status == "pending") {
                                        <a href="@routes.UserPublicationController.editPublicationForm(pub.id.get)" class="u-btn u-btn-secondary u-btn-sm">‚úèÔ∏è Editar</a>
                                    }
                                    @if(pub.status == "rejected") {
                                        <a href="@routes.UserPublicationController.editPublicationForm(pub.id.get)" class="u-btn u-btn-secondary u-btn-sm">Editar</a>
                                        @if(pub.rejectionReason.isDefined) {
                                            <button class="u-btn u-btn-sm" style="background:#fbf3db;color:#7c6a2e;border:1px solid #f0e4b8;" onclick="alert('Motivo: @pub.rejectionReason.get')">Motivo</button>
                                        }
                                    }
                                </div>
                            </td>
                            <td style="text-align: center;">
                                <form method="POST" action="@routes.UserPublicationController.deletePublication(pub.id.get)" style="display:inline;" onsubmit="return confirm('¬øEst√°s seguro de que deseas eliminar la publicaci√≥n \'@pub.title.replace("'", "\\'")\' ? Esta acci√≥n no se puede deshacer.');">
                                    @helper.CSRF.formField
                                    <button type="submit" class="u-btn u-btn-danger u-btn-sm" title="Eliminar publicaci√≥n" style="display:inline-flex; align-items:center; gap:0.25rem;">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
}

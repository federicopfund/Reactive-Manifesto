// ============================================
// Responsive Consolidado — Mobile First
// iPhone 8 (375×667) y dispositivos similares
// ============================================

// ── iPhone 8 / Small Mobile (≤ 414px) ──
@media (max-width: 414px) {

  // ── NAVBAR ──
  .navbar {
    height: 54px;

    .container {
      padding-left: $spacing-3;
      padding-right: $spacing-3;
      gap: $spacing-2;
    }

    &-brand h1 {
      font-size: 0.8125rem;
      gap: 0.375rem;

      &::before {
        width: 6px;
        height: 6px;
      }
    }
  }

  .hamburger {
    width: 36px;
    height: 36px;

    &-line {
      width: 16px;

      &:nth-child(1) { top: 11px; }
      &:nth-child(3) { bottom: 11px; }
    }
  }

  .theme-toggle {
    width: 36px;
    height: 36px;
    font-size: 1rem;
  }

  .navbar-mobile-controls {
    gap: 0.375rem;
  }

  // Mobile menu overlay adjustments for small screens
  .navbar-menu {
    padding: $spacing-6 $spacing-4;

    &.active {
      padding-top: 80px; // Clear the navbar
    }
  }

  .nav-link {
    max-width: 100%;
    padding: 0.75rem 1rem;
    font-size: 1rem;
  }

  .nav-dropdown {
    max-width: 100%;
  }

  .nav-dropdown-toggle {
    font-size: 1rem;
    padding: 0.75rem 1rem;
  }

  // Command palette trigger hidden on very small screens
  .cmd-trigger-main {
    display: none;
  }

  // ── HERO ──
  .hero {
    padding: $spacing-2xl 0 $spacing-xl;

    &-content {
      padding: 0 $spacing-2;
    }

    &-title {
      font-size: $font-size-2xl;
      letter-spacing: -0.015em;

      &::after {
        width: 60%;
        height: 2px;
        bottom: -6px;
      }
    }

    &-subtitle {
      font-size: 0.875rem;
      line-height: 1.5;
      margin-bottom: $spacing-lg;
    }

    &-cta {
      margin-top: $spacing-lg;
      gap: $spacing-md;
      padding: 0 $spacing-2;

      .btn {
        width: 100%;
        padding: 0.75rem 1.25rem;
        font-size: 0.875rem;
      }
    }
  }

  // ── SECTIONS ──
  section {
    padding: $spacing-10 0;
  }

  .section-title {
    font-size: $font-size-xl !important;
    padding: 0 $spacing-1;
  }

  .section-subtitle {
    font-size: $font-size-sm;
    padding: 0 $spacing-1;
  }

  // ── PRINCIPLES GRID ──
  .principles-grid {
    grid-template-columns: 1fr;
    gap: $spacing-lg;
    margin-top: $spacing-xl;
  }

  .principle-card {
    padding: $spacing-lg;

    .principle-icon {
      font-size: 2.25rem;
      margin-bottom: $spacing-sm;
    }

    h3 {
      font-size: $font-size-xl;
    }

    p {
      font-size: $font-size-sm;
    }

    .principle-features li {
      font-size: $font-size-xs;
      padding: $spacing-xs 0;
    }
  }

  // ── BENEFITS ──
  .benefits-content {
    margin-top: $spacing-xl;
  }

  .benefit-item {
    padding: $spacing-lg;
    flex-direction: column;
    gap: $spacing-md;

    .benefit-number {
      font-size: $font-size-3xl;
      min-width: auto;
    }

    h3 {
      font-size: $font-size-lg;
    }
  }

  // ── PUBLICATIONS ──
  .publications-grid {
    grid-template-columns: 1fr;
    gap: $spacing-lg;
    margin-top: $spacing-xl;
  }

  .publication-card {
    padding: $spacing-lg;
    padding-top: calc($spacing-lg + 4px);
  }

  .publication-header {
    flex-direction: column;
    align-items: flex-start;
    gap: $spacing-sm;
    margin-bottom: $spacing-md;
    padding-bottom: $spacing-sm;
  }

  .publication-category {
    padding: 0.375rem 0.75rem;
    font-size: 0.6875rem;
  }

  .publication-title {
    font-size: 1.125rem;
    line-height: 1.35;
  }

  .publication-excerpt {
    font-size: 0.875rem;
    -webkit-line-clamp: 2;
    line-clamp: 2;
  }

  .publication-tags .tag {
    padding: 0.25rem 0.5rem;
    font-size: 0.625rem;
  }

  .publication-link {
    font-size: 0.75rem;
  }

  // Publication Search Bar
  .pub-search-bar {
    margin-top: $spacing-lg;
  }

  .pub-search-form {
    border-radius: $border-radius-md;
  }

  .pub-search-input {
    font-size: 0.875rem;
    padding: 0.75rem 0;
  }

  .pub-search-btn {
    padding: 0.75rem 1rem;
    font-size: 0.75rem;
  }

  // Category Pills
  .pub-category-nav {
    top: 54px; // Match smaller navbar height

    .container {
      padding-left: $spacing-3;
      padding-right: $spacing-3;
    }
  }

  .pub-pill {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
  }

  // ── PORTFOLIO ──
  .portfolio-grid {
    grid-template-columns: 1fr;
    gap: $spacing-lg;
  }

  .portfolio-image {
    height: 180px;
  }

  .portfolio-content {
    padding: $spacing-lg;
  }

  .portfolio-title {
    font-size: 1.125rem;
  }

  .portfolio-description {
    font-size: 0.875rem;
  }

  .portfolio-tech {
    gap: 0.25rem;
  }

  .tech-badge {
    padding: 0.25rem 0.625rem;
    font-size: 0.6875rem;
  }

  .portfolio-links {
    flex-direction: column;
    gap: $spacing-sm;
  }

  .portfolio-link {
    width: 100%;
    padding: 0.625rem 1rem;
    font-size: 0.8125rem;
  }

  .portfolio-stack {
    padding: $spacing-sm $spacing-md;

    h4 {
      font-size: 0.8125rem;
    }

    .stack-list li {
      font-size: 0.75rem;
    }
  }

  // Portfolio filters
  .portfolio-filters {
    gap: 0.375rem;
    margin-bottom: $spacing-xl;
  }

  .filter-btn {
    padding: 0.5rem 0.875rem;
    font-size: 0.8125rem;
  }

  // ── CONTACT ──
  .contact-wrapper {
    grid-template-columns: 1fr;
    gap: $spacing-lg;
    margin-top: $spacing-xl;
  }

  .contact-form {
    padding: $spacing-lg;
  }

  .form-group {
    margin-bottom: $spacing-md;

    label {
      font-size: $font-size-xs;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    textarea,
    select {
      padding: $spacing-sm $spacing-md;
      font-size: 16px; // Prevent iOS zoom on focus
    }

    textarea {
      min-height: 100px;
    }
  }

  // ── NEWSLETTER ──
  .newsletter-section {
    padding: $spacing-2xl 0;

    .section-title {
      font-size: 1.25rem !important;
    }

    .newsletter-form {
      flex-direction: column;
      gap: $spacing-sm;

      .newsletter-input {
        min-width: 100%;
        padding: 0.75rem 1rem;
        font-size: 16px; // Prevent iOS zoom
      }

      .btn {
        width: 100%;
        padding: 0.75rem 1.5rem;
      }
    }
  }

  // ── FOOTER ──
  .footer {
    padding: $spacing-2xl 0 0;
    margin-top: $spacing-3xl;

    .container {
      padding-left: $spacing-3;
      padding-right: $spacing-3;
    }
  }

  .footer-grid {
    grid-template-columns: 1fr;
    gap: $spacing-lg;
    padding-bottom: $spacing-lg;
  }

  .footer-brand {
    text-align: center;

    p {
      max-width: 100%;
    }
  }

  .footer-principles {
    justify-content: center;
  }

  .footer-col {
    text-align: center;

    h4 {
      margin-bottom: 0.5rem;
    }
  }

  .footer-bottom {
    padding: $spacing-md 0;
  }

  // ── CARDS ──
  .card {
    padding: $spacing-lg;
  }

  // ── BUTTONS ──
  .btn {
    padding: 0.75rem 1.25rem;
    font-size: 0.875rem;
    border-radius: $border-radius-md;

    &-lg {
      padding: 0.875rem 1.75rem;
      font-size: 1rem;
      border-radius: $border-radius-lg;
    }
  }

  // ── CTA Section ──
  .cta-section {
    padding: $spacing-2xl 0;

    .cta-content {
      padding: $spacing-xl $spacing-md;

      &::before {
        font-size: 2rem;
        top: -24px;
      }
    }

    .section-title {
      font-size: 1.5rem !important;
    }

    .section-subtitle {
      font-size: 1rem;
      margin-bottom: $spacing-xl;
    }

    .cta-buttons {
      flex-direction: column;
      align-items: stretch;

      .btn {
        width: 100%;
        max-width: 100%;
        padding: 0.875rem 1.5rem;
        font-size: 0.9375rem;
      }
    }
  }

  // ── BACK TO TOP ──
  .back-to-top {
    bottom: 1rem;
    right: 1rem;
    width: 36px;
    height: 36px;
  }

  // ── COMMAND PALETTE ──
  .cmd-palette-main {
    width: calc(100vw - 1rem);
    max-height: 70vh;
    border-radius: $border-radius-lg;
  }

  .cmd-search-row-main {
    padding: 0.625rem 0.75rem;
  }

  .cmd-input-main {
    font-size: 16px; // Prevent iOS zoom
  }

  // ── ARTICLES ──
  .article-header {
    padding: $spacing-3xl 0 $spacing-2xl;

    .article-meta {
      flex-wrap: wrap;
      gap: $spacing-sm;
    }

    .article-category {
      padding: 0.375rem 0.875rem;
      font-size: $font-size-xs;
    }

    .article-title {
      font-size: 1.5rem;
    }

    .article-tags {
      gap: $spacing-sm;

      .tag {
        padding: 0.3rem 0.75rem;
        font-size: 0.6rem;
      }
    }
  }

  .article-content {
    padding: $spacing-xl $spacing-md;

    .article-section {
      padding: $spacing-lg;
      margin-bottom: $spacing-lg;
    }
  }

  // ── AUTH PAGES ──
  .auth-page {
    padding: $spacing-4 $spacing-3;
    align-items: flex-start;
    padding-top: $spacing-8;
  }

  .login-container,
  .register-container {
    max-width: 100%;
    border-radius: $border-radius-lg;
  }

  .login-header,
  .register-header {
    padding: $spacing-6 $spacing-4;

    .header-icon {
      font-size: $font-size-3xl;
    }

    h1 {
      font-size: $font-size-xl;
    }
  }

  .login-body,
  .register-body {
    padding: $spacing-5 $spacing-4;
  }

  // ── DASHBOARD ──
  .dashboard-hero {
    padding: $spacing-2xl 0 $spacing-xl;
  }

  .dashboard-welcome {
    margin-bottom: $spacing-xl;
  }

  .dashboard-title,
  .dashboard-title-simple {
    font-size: clamp(1.5rem, 6vw, 2rem);

    .title-greeting {
      font-size: 0.8125rem;
    }
  }

  .dashboard-subtitle {
    font-size: 0.8125rem;
  }

  .dashboard-grid {
    grid-template-columns: 1fr;
    gap: $spacing-4;
  }

  .dashboard-card {
    padding: $spacing-4;
  }

  .card-icon {
    width: 44px;
    height: 44px;

    svg {
      width: 22px;
      height: 22px;
    }
  }

  .card-title {
    font-size: $font-size-lg;
  }

  .card-description {
    font-size: $font-size-xs;
    min-height: auto;
  }

  .card-stats {
    gap: $spacing-3;
  }

  // Stats
  .stats-cards-grid {
    grid-template-columns: 1fr;
    gap: $spacing-3;
  }

  .stat-card {
    padding: $spacing-4;
    gap: $spacing-3;
  }

  .stat-icon {
    width: 44px;
    height: 44px;
    font-size: $font-size-xl;
  }

  .stat-value {
    font-size: $font-size-xl;
  }

  // Quick actions
  .actions-grid {
    flex-direction: column;
    gap: $spacing-3;
  }

  .action-item {
    min-width: 100%;
    padding: $spacing-3;
  }

  // Governance bar
  .governance-bar {
    padding: $spacing-3;
  }

  .governance-content {
    gap: $spacing-2;
  }

  // Favorites
  .favorites-grid {
    grid-template-columns: 1fr;
    gap: $spacing-3;
  }

  // Learning progress
  .learning-progress {
    padding: $spacing-4;
  }

  // ── AUTH MODAL ──
  .auth-modal-content {
    width: calc(100% - 1rem);
    max-height: calc(100vh - 1rem);
    border-radius: $border-radius-lg;
  }

  .auth-modal-header {
    padding: $spacing-4 $spacing-3;
  }

  .auth-modal-body {
    padding: $spacing-3;
  }

  .auth-modal-actions {
    flex-direction: column;
    gap: $spacing-2;

    .btn {
      width: 100%;
    }
  }

  // ── GRAPH POPUP ──
  .graph-popup-content {
    padding: $spacing-md;
  }

  #graphSvg {
    height: 260px;
  }

  // ── ALERTS ──
  .alert {
    padding: $spacing-sm $spacing-md;
    font-size: $font-size-sm;
    border-radius: $border-radius-md;
  }

  // ── VERIFICATION ──
  .verification-container,
  .verification-card {
    padding: $spacing-lg;
    margin: $spacing-md;
  }
}

// ── General Tablet Portrait (≤ 768px) — already handled by $breakpoint-md
// Extra safeguards for elements that may overflow ──
@media (max-width: $breakpoint-md) {

  // Ensure container never causes horizontal scroll
  .container {
    padding-left: $spacing-4;
    padding-right: $spacing-4;
    overflow-x: hidden;
  }

  // Generic overflow prevention 
  body {
    overflow-x: hidden;
  }

  // Images must never overflow
  img, video, iframe, canvas, svg {
    max-width: 100%;
    height: auto;
  }

  // Tables should scroll horizontally
  table {
    display: block;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  // Prevent text from overflowing containers
  h1, h2, h3, h4, h5, h6, p {
    overflow-wrap: break-word;
    word-break: break-word;
  }

  // Code blocks: force horizontal scroll
  pre {
    max-width: 100%;
    overflow-x: auto;
  }

  // Ensure inputs don't zoom page on iOS (min 16px)
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="number"],
  input[type="tel"],
  input[type="url"],
  textarea,
  select {
    font-size: 16px;
  }
}

// ── Small Mobile Landscape (≤ 667px height, landscape) ──
@media (max-height: 500px) and (orientation: landscape) {
  .navbar {
    height: 48px;
  }

  .hero {
    padding: $spacing-lg 0;

    &-title {
      font-size: $font-size-2xl;
    }

    &-subtitle {
      font-size: 0.8125rem;
    }
  }

  .navbar-menu.active {
    padding-top: 56px;
    overflow-y: auto;
  }
}

// ── Touch-specific optimizations ──
@media (hover: none) and (pointer: coarse) {
  // Larger touch targets
  .nav-link {
    min-height: 44px;
  }

  .btn {
    min-height: 44px;
  }

  .hamburger {
    min-width: 44px;
    min-height: 44px;
  }

  .theme-toggle {
    min-width: 44px;
    min-height: 44px;
  }

  // Disable hover-only effects on touch devices
  .portfolio-card:hover {
    transform: translateY(-4px) scale(1);
  }

  .card:hover {
    transform: translateY(-3px);
  }

  .principle-card:hover {
    transform: translateY(-3px);
  }

  .publication-card:hover {
    transform: translateY(-2px);
  }

  // Remove hover glow effects that are GPU-intensive on mobile
  .card:hover::after {
    opacity: 0;
  }

  .btn:hover::before {
    display: none;
  }
}
